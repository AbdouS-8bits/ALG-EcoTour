// This is your Prisma schema file,
// learn more about it in docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  name      String?
  phone     String?
  password  String    // Store hashed passwords in production
  role      String    @default("user") // "admin" or "user"
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  adminAuditLogs AdminAuditLog[]
  userSettings UserSettings?
  reviews Review[]

  @@map("users")
}

model UserSettings {
  id                  Int      @id @default(autoincrement())
  userId              Int      @unique
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  language            String   @default("ar") // "ar", "fr", "en"
  emailNotifications  Boolean  @default(true)
  darkMode            Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("user_settings")
}

model AdminAuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  action    String
  details   String?
  createdAt DateTime @default(now())

  @@map("admin_audit_logs")
}

model EcoTour {
  id               Int      @id @default(autoincrement())
  title            String
  description      String   @db.Text
  location         String
  latitude         Float
  longitude        Float
  price            Float
  maxParticipants  Int
  photoURL         String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  reviews Review[]

  @@map("eco_tours")
}

model Booking {
  id            Int      @id @default(autoincrement())
  tourId        Int
  guestName     String
  guestEmail    String
  guestPhone    String
  participants  Int
  status        String   @default("pending") // "pending", "confirmed", "cancelled"
  paymentStatus String   @default("PENDING") // "PENDING", "PAID", "FAILED"
  notes         String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("bookings")
}

model Review {
  id          Int      @id @default(autoincrement())
  rating      Int       @default(3) // 1-5 rating scale
  comment     String    @db.Text
  tourId      Int
  userId      Int      // User who wrote the review
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  tour        EcoTour   @relation(fields: [tourId], references: [id], onDelete: Cascade])
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade])

  @@map("reviews")
}